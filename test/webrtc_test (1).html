<!DOCTYPE html>
<html>
<head>
    <title>WebRTC IP Detection Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .ip-list { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 5px; }
        .ip-item { margin: 5px 0; padding: 5px; background: white; border-radius: 3px; }
        button { padding: 10px 20px; font-size: 16px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        #status { margin: 10px 0; padding: 10px; background: #e9ecef; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>WebRTC IP Address Detection</h1>
        <button onclick="getIPs()">Detect My IPs</button>
        <div id="status">Click the button to start detection</div>
        <h2>Detected IPs:</h2>
        <div id="ips" class="ip-list"></div>
    </div>

    <script>
        // Store detected IPs
        var detectedIPs = [];

        // Function to add IP to the list
        function addIP(ip, type) {
            // Check if IP already exists
            if (detectedIPs.includes(ip)) return;

            detectedIPs.push(ip);

            var ipDiv = document.createElement('div');
            ipDiv.className = 'ip-item';
            ipDiv.innerHTML = '<strong>' + type + ':</strong> ' + ip;
            document.getElementById('ips').appendChild(ipDiv);

            console.log('Detected ' + type + ' IP: ' + ip);
        }

        // Main function to get IPs using WebRTC
        function getIPs() {
            // Clear previous results
            detectedIPs = [];
            document.getElementById('ips').innerHTML = '';
            document.getElementById('status').innerHTML = 'Detecting IPs...';

            // Modern standard way
            if (window.RTCPeerConnection) {
                getIPsModern();
            } else {
                document.getElementById('status').innerHTML = 'WebRTC not supported in this browser';
            }
        }

        // Modern approach using RTCPeerConnection
        function getIPsModern() {
            var pc = new RTCPeerConnection({
                iceServers: []
            });

            // Listen for candidate events
            pc.onicecandidate = function(ice) {
                if (!ice || !ice.candidate || !ice.candidate.candidate) return;

                var candidate = ice.candidate.candidate;

                // Extract IP using regex
                var ipRegex = /([0-9]{1,3}(\.[0-9]{1,3}){3})/;
                var ipMatch = ipRegex.exec(candidate);

                if (ipMatch && ipMatch[1]) {
                    var ip = ipMatch[1];

                    // Filter out invalid IPs
                    if (ip !== '0.0.0.0' && !ip.startsWith('127.') && ip !== '255.255.255.255') {
                        // Determine IP type
                        var type = 'Public';
                        if (ip.startsWith('192.168.') ||
                            ip.startsWith('10.') ||
                            (ip.startsWith('172.') &&
                             parseInt(ip.split('.')[1]) >= 16 &&
                             parseInt(ip.split('.')[1]) <= 31)) {
                            type = 'Private';
                        }

                        addIP(ip, type);
                    }
                }

                document.getElementById('status').innerHTML = 'Found ' + detectedIPs.length + ' IP(s)';
            };

            // Create a data channel and offer
            pc.createDataChannel('');
            pc.createOffer()
                .then(function(offer) {
                    return pc.setLocalDescription(offer);
                })
                .catch(function(err) {
                    console.error('Error creating offer:', err);
                    document.getElementById('status').innerHTML = 'Error: ' + err;
                });
        }

        // Run detection automatically when page loads
        window.onload = function() {
            setTimeout(getIPs, 1000); // Wait a bit for page to load completely
        };
    </script>
</body>
</html>

