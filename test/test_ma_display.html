<!DOCTYPE html>
<html>
<head>
    <title>MA Display Test</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.0/dist/echarts.min.js"></script>
</head>
<body>
    <h1>MA Display Test</h1>
    <div id="chart" style="width: 100%; height: 500px;"></div>

    <script>
        // Test data
        const dates = ['2023-01-01', '2023-01-02', '2023-01-03', '2023-01-04', '2023-01-05',
                      '2023-01-06', '2023-01-07', '2023-01-08', '2023-01-09', '2023-01-10'];
        const closes = [100, 102, 101, 103, 105, 104, 106, 108, 107, 109];
        const ohlcData = [[100, 100, 99, 101], [102, 102, 100, 103], [101, 101, 100, 102],
                         [103, 103, 101, 104], [105, 105, 103, 106], [104, 104, 103, 105],
                         [106, 106, 104, 107], [108, 108, 106, 109], [107, 107, 106, 108],
                         [109, 109, 107, 110]];

        // MA calculation function
        function calculateMA(data, period) {
            if (!data || data.length < period || period <= 0) return [];

            const ma = [];
            for (let i = 0; i < data.length; i++) {
                if (i < period - 1) {
                    ma.push(null);
                } else {
                    const sum = data.slice(i - period + 1, i + 1).reduce((a, b) => a + b, 0);
                    ma.push(sum / period);
                }
            }

            return ma;
        }

        // Calculate MA lines
        const ma5 = calculateMA(closes, 5);
        const ma13 = calculateMA(closes, 13); // Will be all null since we don't have enough data
        const ma34 = calculateMA(closes, 34); // Will be all null since we don't have enough data

        console.log('MA5:', ma5);
        console.log('MA13:', ma13);
        console.log('MA34:', ma34);

        // Initialize chart
        const chart = echarts.init(document.getElementById('chart'));

        // Chart option
        const option = {
            title: {
                text: 'K-line with MA Lines'
            },
            tooltip: {
                trigger: 'axis'
            },
            grid: {
                left: '10%',
                right: '10%',
                top: '15%',
                height: '70%'
            },
            xAxis: {
                type: 'category',
                data: dates
            },
            yAxis: {
                scale: true
            },
            series: [
                {
                    name: 'K-line',
                    type: 'candlestick',
                    data: ohlcData
                },
                // MA lines
                {
                    name: 'MA5',
                    type: 'line',
                    data: ma5,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 2,
                        color: '#ff9900'
                    }
                }
            ]
        };

        // Set chart option
        chart.setOption(option);
    </script>
</body>
</html>

